# I18n (Internationalization)

Complete internationalization support for business code messages with React Provider pattern.

## Table of Contents

- [Supported Locales](#supported-locales)
- [Import](#import)
- [React Integration](#react-integration)
- [Hook API](#hook-api)
- [Direct Usage (Without React)](#direct-usage-without-react)
- [BusinessMessageProvider Class](#businessmessageprovider-class)
- [Message Fallback](#message-fallback)
- [Complete Message Reference](#complete-message-reference)
- [TypeScript Types](#typescript-types)

---

## Supported Locales

| Locale | Language                | Flag |
| ------ | ----------------------- | ---- |
| `en`   | English (default)       | üá∫üá∏   |
| `vi`   | Vietnamese (Ti·∫øng Vi·ªát) | üáªüá≥   |

---

## Import

```typescript
// Core functions (non-React)
import {
  getLocalizedMessage,
  setLocale,
  registerMessages,
  messageProvider,
  BusinessMessageProvider,
  enMessages,
  viMessages,
  DEFAULT_UNKNOWN_MESSAGE,
} from "@tchil/business-codes/i18n";

// React integration
import {
  BusinessMessageProvider,
  useBusinessMessage,
  BusinessMessageContext,
} from "@tchil/business-codes/i18n/react";

// Types
import type {
  Locale,
  MessageMap,
  I18nConfig,
} from "@tchil/business-codes/i18n";

import type { BusinessMessageProviderProps } from "@tchil/business-codes/i18n/react";
```

---

## React Integration

### Step 1: Setup Provider (One-time in Layout)

```tsx
// app/layout.tsx
import { BusinessMessageProvider } from "@tchil/business-codes/i18n/react";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // Get locale from cookie, header, or user preference
  const locale = cookies().get("locale")?.value || "vi";

  return (
    <html lang={locale}>
      <body>
        <BusinessMessageProvider locale={locale}>
          {children}
        </BusinessMessageProvider>
      </body>
    </html>
  );
}
```

### Step 2: Use in Any Component

```tsx
"use client";

import { useBusinessMessage } from "@tchil/business-codes/i18n/react";

function MyComponent() {
  const { getMessage, getResponseMessage, getErrorMessage, locale } =
    useBusinessMessage();

  const handleApiCall = async () => {
    try {
      const response = await fetch("/api/users/123");
      const data = await response.json();

      if (!data.success) {
        // Automatically uses locale from provider
        toast.error(getResponseMessage(data));
        // Vietnamese: "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng"
        // English: "User not found"
      }
    } catch (error) {
      toast.error(getErrorMessage(error));
    }
  };

  return (
    <div>
      <p>Current locale: {locale}</p>
      <button onClick={handleApiCall}>Fetch User</button>
    </div>
  );
}
```

### Step 3: Custom Message Override (Optional)

```tsx
<BusinessMessageProvider
  locale="vi"
  customMessages={{
    2001: "T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng", // Override default
    9001: "L·ªói t√πy ch·ªânh c·ªßa ·ª©ng d·ª•ng", // Add new code
  }}
  fallbackLocale="en"
>
  {children}
</BusinessMessageProvider>
```

### Provider Props

```typescript
interface BusinessMessageProviderProps {
  /** Current locale */
  locale: Locale; // Required: "en" | "vi"

  /** Custom messages to override defaults */
  customMessages?: MessageMap; // Optional: Record<number, string>

  /** Fallback locale when message not found */
  fallbackLocale?: Locale; // Optional: Default "en"

  /** React children */
  children: React.ReactNode;
}
```

---

## Hook API

### `useBusinessMessage()`

Must be used within a `BusinessMessageProvider`.

```typescript
const {
  locale, // Current locale: "en" | "vi"
  getMessage, // (code: number) => string
  getResponseMessage, // <T>(response: ApiResponse<T>) => string
  getErrorMessage, // (error: unknown) => string
} = useBusinessMessage();
```

---

### `getMessage(code)`

Get localized message by business code.

```typescript
function getMessage(code: number): string;
```

**Examples:**

```typescript
const { getMessage } = useBusinessMessage();

getMessage(0); // "Thao t√°c th√†nh c√¥ng" (vi) / "Operation completed successfully" (en)
getMessage(2001); // "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng" (vi) / "User not found" (en)
getMessage(1002); // "Token ƒë√£ h·∫øt h·∫°n" (vi) / "Access token has expired" (en)
getMessage(9999); // "L·ªói kh√¥ng x√°c ƒë·ªãnh" (vi) / "Unknown error" (en)
```

---

### `getResponseMessage<T>(response)`

Extract and localize message from API response.

```typescript
function getResponseMessage<T>(response: ApiResponse<T>): string;
```

**API Response Structure:**

```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
  error?: {
    code?: number;
    details?: Record<string, unknown>;
  };
}
```

**Examples:**

```typescript
const { getResponseMessage } = useBusinessMessage();

// Success response
const successResponse = { success: true, data: { id: 1 }, message: "Success" };
getResponseMessage(successResponse);
// ‚Üí "Success" (uses response.message)

// Error response with code
const errorResponse = { success: false, error: { code: 2001 } };
getResponseMessage(errorResponse);
// ‚Üí "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng" (vi)

// Error response without code
const genericError = { success: false, message: "Something went wrong" };
getResponseMessage(genericError);
// ‚Üí "Something went wrong" (uses response.message)
```

---

### `getErrorMessage(error)`

Get message from any error type.

```typescript
function getErrorMessage(error: unknown): string;
```

**Examples:**

```typescript
const { getErrorMessage } = useBusinessMessage();

getErrorMessage(new Error("Network failed"));
// ‚Üí "Network failed"

getErrorMessage("Connection timeout");
// ‚Üí "Connection timeout"

getErrorMessage({ some: "object" });
// ‚Üí "L·ªói m√°y ch·ªß n·ªôi b·ªô" (vi) / "Internal server error" (en)
```

---

## Direct Usage (Without React)

For server-side code, API routes, or non-React environments.

### `setLocale(locale)`

Set the global locale for the singleton provider.

```typescript
function setLocale(locale: Locale): void;
```

**Example:**

```typescript
import { setLocale, getLocalizedMessage } from "@tchil/business-codes/i18n";

setLocale("vi");
getLocalizedMessage(2001); // "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng"

setLocale("en");
getLocalizedMessage(2001); // "User not found"
```

---

### `getLocalizedMessage(code, locale?)`

Get localized message with optional locale override.

```typescript
function getLocalizedMessage(code: number, locale?: Locale): string;
```

**Examples:**

```typescript
import { getLocalizedMessage, setLocale } from "@tchil/business-codes/i18n";

// Uses global locale
setLocale("vi");
getLocalizedMessage(2001); // "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng"

// Override with specific locale
getLocalizedMessage(2001, "en"); // "User not found"
getLocalizedMessage(2001, "vi"); // "Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng"
```

---

### `registerMessages(locale, messages)`

Register custom messages globally.

```typescript
function registerMessages(locale: Locale, messages: MessageMap): void;
```

**Example:**

```typescript
import {
  registerMessages,
  getLocalizedMessage,
} from "@tchil/business-codes/i18n";

// Override existing message
registerMessages("vi", {
  2001: "Ng∆∞·ªùi d√πng kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng",
});

// Add new custom code
registerMessages("en", {
  9001: "Custom application error",
});

registerMessages("vi", {
  9001: "L·ªói t√πy ch·ªânh c·ªßa ·ª©ng d·ª•ng",
});

getLocalizedMessage(9001, "en"); // "Custom application error"
getLocalizedMessage(9001, "vi"); // "L·ªói t√πy ch·ªânh c·ªßa ·ª©ng d·ª•ng"
```

---

### `messageProvider`

Singleton instance of `BusinessMessageProvider`.

```typescript
import { messageProvider } from "@tchil/business-codes/i18n";

messageProvider.setLocale("vi");
messageProvider.getMessage(2001);
messageProvider.registerMessages("vi", { 9001: "Custom" });
```

---

## BusinessMessageProvider Class

For advanced usage, create your own instance.

### Constructor

```typescript
class BusinessMessageProvider {
  constructor(config?: Partial<I18nConfig>);
}

interface I18nConfig {
  locale: Locale; // Default: "en"
  fallbackLocale?: Locale; // Default: "en"
  customMessages?: Partial<Record<Locale, MessageMap>>;
}
```

### Methods

```typescript
class BusinessMessageProvider {
  // Get/set current locale
  setLocale(locale: Locale): void;
  getLocale(): Locale;

  // Get message
  getMessage(code: number, locale?: Locale): string;

  // Check if message exists
  hasMessage(code: number, locale?: Locale): boolean;

  // Register custom messages
  registerMessages(locale: Locale, messages: MessageMap): void;
}
```

### Example

```typescript
import { BusinessMessageProvider } from "@tchil/business-codes/i18n";

const provider = new BusinessMessageProvider({
  locale: "vi",
  fallbackLocale: "en",
  customMessages: {
    vi: {
      2001: "T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i",
      9001: "L·ªói t√πy ch·ªânh",
    },
    en: {
      9001: "Custom error",
    },
  },
});

provider.getMessage(2001); // "T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i" (custom vi)
provider.getMessage(1001); // "X√°c th·ª±c th·∫•t b·∫°i" (built-in vi)
provider.getMessage(9001); // "L·ªói t√πy ch·ªânh" (custom vi)

provider.setLocale("en");
provider.getMessage(2001); // "User not found" (built-in en)
provider.getMessage(9001); // "Custom error" (custom en)

provider.hasMessage(2001); // true
provider.hasMessage(99999); // false
```

---

## Message Fallback

Message resolution priority:

1. **Custom messages** for target locale
2. **Built-in messages** for target locale
3. **Custom messages** for fallback locale (default: `en`)
4. **Built-in messages** for fallback locale
5. **Default unknown message**
   - English: `"Unknown error"`
   - Vietnamese: `"L·ªói kh√¥ng x√°c ƒë·ªãnh"`

---

## Complete Message Reference

### Success Codes (0-99)

| Code | English                           | Vietnamese                |
| ---- | --------------------------------- | ------------------------- |
| 0    | Operation completed successfully  | Thao t√°c th√†nh c√¥ng       |
| 1    | Resource created successfully     | T·∫°o m·ªõi th√†nh c√¥ng        |
| 2    | Resource updated successfully     | C·∫≠p nh·∫≠t th√†nh c√¥ng       |
| 3    | Resource deleted successfully     | X√≥a th√†nh c√¥ng            |
| 4    | Operation accepted for processing | Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c ti·∫øp nh·∫≠n |
| 5    | No changes were made              | Kh√¥ng c√≥ thay ƒë·ªïi         |

### Authentication Codes (1xxx)

| Code | English                            | Vietnamese                       |
| ---- | ---------------------------------- | -------------------------------- |
| 1001 | Authentication failed              | X√°c th·ª±c th·∫•t b·∫°i                |
| 1002 | Access token has expired           | Token ƒë√£ h·∫øt h·∫°n                 |
| 1003 | Access token is invalid            | Token kh√¥ng h·ª£p l·ªá               |
| 1004 | Access token is missing            | Thi·∫øu token x√°c th·ª±c             |
| 1005 | Refresh token has expired          | Refresh token ƒë√£ h·∫øt h·∫°n         |
| 1006 | Refresh token is invalid           | Refresh token kh√¥ng h·ª£p l·ªá       |
| 1007 | Insufficient permissions           | Kh√¥ng ƒë·ªß quy·ªÅn truy c·∫≠p          |
| 1008 | Account is locked                  | T√†i kho·∫£n ƒë√£ b·ªã kh√≥a             |
| 1009 | Account is not verified            | T√†i kho·∫£n ch∆∞a ƒë∆∞·ª£c x√°c minh     |
| 1010 | Session has expired                | Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n       |
| 1011 | Invalid API key                    | API key kh√¥ng h·ª£p l·ªá             |
| 1012 | Too many authentication attempts   | Qu√° nhi·ªÅu l·∫ßn ƒëƒÉng nh·∫≠p th·∫•t b·∫°i |
| 1013 | Two-factor authentication required | Y√™u c·∫ßu x√°c th·ª±c hai y·∫øu t·ªë      |
| 1014 | Two-factor authentication failed   | X√°c th·ª±c hai y·∫øu t·ªë th·∫•t b·∫°i     |
| 1015 | OAuth authentication failed        | ƒêƒÉng nh·∫≠p OAuth th·∫•t b·∫°i         |
| 1016 | OAuth provider error               | L·ªói nh√† cung c·∫•p OAuth           |

### User Codes (2xxx)

| Code | English                     | Vietnamese                     |
| ---- | --------------------------- | ------------------------------ |
| 2001 | User not found              | Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng      |
| 2002 | User already exists         | Ng∆∞·ªùi d√πng ƒë√£ t·ªìn t·∫°i          |
| 2003 | User account is inactive    | T√†i kho·∫£n kh√¥ng ho·∫°t ƒë·ªông      |
| 2004 | Invalid credentials         | Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ƒë√∫ng |
| 2005 | User account is suspended   | T√†i kho·∫£n ƒë√£ b·ªã t·∫°m ng∆∞ng      |
| 2006 | User account is deleted     | T√†i kho·∫£n ƒë√£ b·ªã x√≥a            |
| 2007 | Email already in use        | Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng          |
| 2008 | Username already in use     | T√™n ƒëƒÉng nh·∫≠p ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng  |
| 2009 | Phone number already in use | S·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng  |
| 2010 | Invalid email format        | Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng     |
| 2011 | Password is too weak        | M·∫≠t kh·∫©u qu√° y·∫øu               |
| 2012 | Passwords do not match      | M·∫≠t kh·∫©u kh√¥ng kh·ªõp            |
| 2013 | Old password is incorrect   | M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng         |
| 2014 | Profile is incomplete       | H·ªì s∆° ch∆∞a ho√†n thi·ªán          |

### Validation Codes (3xxx)

| Code | English                      | Vietnamese                         |
| ---- | ---------------------------- | ---------------------------------- |
| 3001 | Validation error             | L·ªói x√°c th·ª±c d·ªØ li·ªáu               |
| 3002 | Invalid input                | D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá       |
| 3003 | Required field is missing    | Thi·∫øu tr∆∞·ªùng b·∫Øt bu·ªôc              |
| 3004 | Value is out of range        | Gi√° tr·ªã n·∫±m ngo√†i ph·∫°m vi cho ph√©p |
| 3005 | Invalid format               | ƒê·ªãnh d·∫°ng kh√¥ng h·ª£p l·ªá             |
| 3006 | Field is too long            | Tr∆∞·ªùng qu√° d√†i                     |
| 3007 | Field is too short           | Tr∆∞·ªùng qu√° ng·∫Øn                    |
| 3008 | Invalid date format          | ƒê·ªãnh d·∫°ng ng√†y kh√¥ng h·ª£p l·ªá        |
| 3009 | Date cannot be in the past   | Ng√†y kh√¥ng th·ªÉ ·ªü qu√° kh·ª©           |
| 3010 | Date cannot be in the future | Ng√†y kh√¥ng th·ªÉ ·ªü t∆∞∆°ng lai         |
| 3011 | Invalid file type            | Lo·∫°i t·ªáp kh√¥ng h·ª£p l·ªá              |
| 3012 | File size is too large       | K√≠ch th∆∞·ªõc t·ªáp qu√° l·ªõn             |
| 3013 | Invalid JSON format          | ƒê·ªãnh d·∫°ng JSON kh√¥ng h·ª£p l·ªá        |
| 3014 | Invalid UUID format          | ƒê·ªãnh d·∫°ng UUID kh√¥ng h·ª£p l·ªá        |
| 3015 | Invalid phone number format  | S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá         |
| 3016 | Duplicate entry              | D·ªØ li·ªáu b·ªã tr√πng l·∫∑p               |

### Resource Codes (4xxx)

| Code | English                                  | Vietnamese                            |
| ---- | ---------------------------------------- | ------------------------------------- |
| 4001 | Resource not found                       | Kh√¥ng t√¨m th·∫•y t√†i nguy√™n             |
| 4002 | Resource already exists                  | T√†i nguy√™n ƒë√£ t·ªìn t·∫°i                 |
| 4003 | Resource is locked                       | T√†i nguy√™n ƒëang b·ªã kh√≥a               |
| 4004 | Resource has been deleted                | T√†i nguy√™n ƒë√£ b·ªã x√≥a                  |
| 4005 | Resource has expired                     | T√†i nguy√™n ƒë√£ h·∫øt h·∫°n                 |
| 4006 | Resource limit reached                   | ƒê√£ ƒë·∫°t gi·ªõi h·∫°n t√†i nguy√™n            |
| 4007 | Resource is not available                | T√†i nguy√™n kh√¥ng kh·∫£ d·ª•ng             |
| 4008 | Resource conflict                        | Xung ƒë·ªôt t√†i nguy√™n                   |
| 4009 | Version mismatch                         | Phi√™n b·∫£n kh√¥ng kh·ªõp                  |
| 4010 | Cannot delete resource with dependencies | Kh√¥ng th·ªÉ x√≥a t√†i nguy√™n c√≥ ph·ª• thu·ªôc |

### System Codes (5xxx)

| Code | English                         | Vietnamese                      |
| ---- | ------------------------------- | ------------------------------- |
| 5001 | Internal server error           | L·ªói m√°y ch·ªß n·ªôi b·ªô              |
| 5002 | Database error                  | L·ªói c∆° s·ªü d·ªØ li·ªáu               |
| 5003 | External service error          | L·ªói d·ªãch v·ª• b√™n ngo√†i           |
| 5004 | Service temporarily unavailable | D·ªãch v·ª• t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng |
| 5005 | Configuration error             | L·ªói c·∫•u h√¨nh                    |
| 5006 | Cache error                     | L·ªói b·ªô nh·ªõ ƒë·ªám                  |
| 5007 | File system error               | L·ªói h·ªá th·ªëng t·ªáp                |
| 5008 | Memory limit exceeded           | V∆∞·ª£t qu√° gi·ªõi h·∫°n b·ªô nh·ªõ        |
| 5009 | Operation timed out             | Thao t√°c qu√° th·ªùi gian          |
| 5010 | Queue error                     | L·ªói h√†ng ƒë·ª£i                    |

### External Service Codes (6xxx)

| Code | English                    | Vietnamese            |
| ---- | -------------------------- | --------------------- |
| 6001 | Third-party API error      | L·ªói API b√™n th·ª© ba    |
| 6002 | Payment gateway error      | L·ªói c·ªïng thanh to√°n   |
| 6003 | Email service error        | L·ªói d·ªãch v·ª• email     |
| 6004 | SMS service error          | L·ªói d·ªãch v·ª• SMS       |
| 6005 | Storage service error      | L·ªói d·ªãch v·ª• l∆∞u tr·ªØ   |
| 6006 | Search service error       | L·ªói d·ªãch v·ª• t√¨m ki·∫øm  |
| 6007 | Notification service error | L·ªói d·ªãch v·ª• th√¥ng b√°o |
| 6008 | Analytics service error    | L·ªói d·ªãch v·ª• ph√¢n t√≠ch |

### Business Logic Codes (7xxx)

| Code | English                   | Vietnamese                          |
| ---- | ------------------------- | ----------------------------------- |
| 7001 | Operation not allowed     | Thao t√°c kh√¥ng ƒë∆∞·ª£c ph√©p            |
| 7002 | Insufficient balance      | S·ªë d∆∞ kh√¥ng ƒë·ªß                      |
| 7003 | Transaction failed        | Giao d·ªãch th·∫•t b·∫°i                  |
| 7004 | Order cannot be cancelled | Kh√¥ng th·ªÉ h·ªßy ƒë∆°n h√†ng              |
| 7005 | Order cannot be modified  | Kh√¥ng th·ªÉ ch·ªânh s·ª≠a ƒë∆°n h√†ng        |
| 7006 | Item out of stock         | S·∫£n ph·∫©m h·∫øt h√†ng                   |
| 7007 | Coupon is invalid         | M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá            |
| 7008 | Coupon has expired        | M√£ gi·∫£m gi√° ƒë√£ h·∫øt h·∫°n              |
| 7009 | Minimum order not met     | Ch∆∞a ƒë·∫°t gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu |
| 7010 | Maximum quantity exceeded | V∆∞·ª£t qu√° s·ªë l∆∞·ª£ng t·ªëi ƒëa            |
| 7011 | Subscription required     | Y√™u c·∫ßu ƒëƒÉng k√Ω g√≥i d·ªãch v·ª•         |
| 7012 | Subscription has expired  | G√≥i ƒëƒÉng k√Ω ƒë√£ h·∫øt h·∫°n              |
| 7013 | Feature not available     | T√≠nh nƒÉng kh√¥ng kh·∫£ d·ª•ng            |
| 7014 | Quota exceeded            | ƒê√£ v∆∞·ª£t qu√° h·∫°n m·ª©c                 |
| 7015 | Rate limit exceeded       | ƒê√£ v∆∞·ª£t qu√° gi·ªõi h·∫°n t·∫ßn su·∫•t       |

---

## TypeScript Types

```typescript
import type {
  Locale,
  MessageMap,
  I18nConfig,
} from "@tchil/business-codes/i18n";

import type { BusinessMessageProviderProps } from "@tchil/business-codes/i18n/react";

// Locale = "en" | "vi"
// MessageMap = Record<number, string>
// I18nConfig = { locale: Locale; fallbackLocale?: Locale; customMessages?: ... }
```
